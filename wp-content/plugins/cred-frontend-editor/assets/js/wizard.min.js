(function(o,b,c,p){function j(d){d.preventDefault();var f=b(this),d=b("#post_ID").val();c.doCheck()&&b.ajax({url:c.route(k),data:"form_id="+d+"&field=wizard&value="+a.completed_step,type:"post",success:function(){f.unbind("submit",j);f.submit();return!0}});return!1}function i(a){var f,e=c.getContents(),a=b(a).serializeArray();for(f=0;f<a.length;++f)if(e[a[f].name])a[f].value=e[a[f].name];return b.param(a)}var a,l=c.settings.editurl,k=c.settings.form_controller_url,q=c.settings.wizard_url,m,e,g,n,
h;a={hasSidebar:!1,step:1,prevstep:0,completed_step:0,steps:[{title:c.settings.locale.step_1_title,completed:!1,execute:function(){b("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide();b("#titlediv").show();g.hide();if(a.steps[a.step-1].completed)a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled");else{e.attr("disabled","disabled");h.css("width","20%");var d=setInterval(function(){if(a.steps[a.step-1].completed)clearInterval(d);
else{var c=b("#title");if(""!=b.trim(c.val()))clearInterval(d),a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled")}},500)}}},{title:c.settings.locale.step_2_title,completed:!1,execute:function(){b("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide();b("#credformtypediv").removeClass("closed").show();g.show();if(a.steps[a.step-1].completed)a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled");else{e.attr("disabled",
"disabled");h.css("width","40%");var d=setInterval(function(){if(a.steps[a.step-1].completed)clearInterval(d);else{var c=b('select[name="_cred[form][type]"]');if(""!=b.trim(c.val()))clearInterval(d),a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled")}},500)}}},{title:c.settings.locale.step_3_title,completed:!1,execute:function(){b("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide();b("#credposttypediv").removeClass("closed").show();
g.show();if(a.steps[a.step-1].completed)a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled");else{e.attr("disabled","disabled");h.css("width","60%");var d=setInterval(function(){if(a.steps[a.step-1].completed)clearInterval(d);else{var c=b('select[name="_cred[post][post_type]"]');if(""!=b.trim(c.val()))clearInterval(d),a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled")}},500)}}},{title:c.settings.locale.step_4_title,completed:!1,execute:function(){b("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide();
b("#credformcontentdiv").removeClass("closed").show();g.show();if(a.steps[a.step-1].completed)a.steps[a.step-1].completed=!0,a.completed_step=a.step,e.removeAttr("disabled");else{e.attr("disabled","disabled");h.css("width","80%");var d=setInterval(function(){if(a.steps[a.step-1].completed)clearInterval(d);else{var f=c.getContents();if(""!=b.trim(f.content))clearInterval(d),a.completed_step=a.step,a.steps[a.step-1].completed=!0,e.removeAttr("disabled")}},500)}}},{title:c.settings.locale.step_5_title,
completed:!1,execute:function(){b("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide();b("#crednotificationdiv").removeClass("closed").show();g.show();e.removeAttr("disabled");a.completed_step=a.step;a.steps[a.step-1].completed=!0}}],prevStep:function(){a.goToStep(a.step-1)},nextStep:function(){if(m&&1==a.step&&!a.steps[1].completed){var d=b("#post_ID").val();c.doCheck()&&b.ajax({url:l,data:i("#post"),type:"post",success:function(){b.ajax({url:c.route(k),
data:"form_id="+d+"&field=wizard&value="+a.completed_step,type:"post",success:function(){document.location=l+"?action=edit&post="+d}})}})}else if(c.doCheck()){var e=a.completed_step;a.completed_step==a.steps.length&&(e=-1);b.ajax({url:document.location,data:i("#post")+"&_cred[wizard]="+e,type:"post",success:function(){}});a.goToStep(a.step+1)}},goToStep:function(d){if(p!==d&&(d=parseInt(d,10),d<=a.steps.length+1&&d>=1))a.step=d,a.step==a.steps.length+1?a.finish():a.steps[a.step-1]&&b.isFunction(a.steps[a.step-
1].execute)&&(a.step==a.steps.length?e.val(c.settings.locale.finish_text).show():e.val(c.settings.locale.next_text).show(),a.steps[a.step-1].execute(),c.app.dispatch("cred.wizardChangedStep"))},start:function(){b("#postbox-container-2").append('<div class="cred-not-hide cred-wizard-buttons"> <input id="cred_wizard_quit_button" type="button" class="button" value="'+c.settings.locale.quit_wizard_text+'" /> <input type="button" id="cred-wizard-button-prev" class="button" value="'+c.settings.locale.prev_text+
'" /> <input type="button" id="cred-wizard-button-next" class="button-primary" value="'+c.settings.locale.next_text+'" /></div>');b("#post-body-content").prepend('<div class="cred-not-hide cred-progress"><div id="cred-progress-bar"><div id="cred-progress-bar-inner"></div></div></div>');if(b("#post-body").hasClass("columns-2"))a.hasSidebar=!0,b("#postbox-container-1").hide(),b("#post-body").removeClass("columns-2").addClass("columns-1");b("#cred-submit, #cred_add_forms_to_site_help").hide();b("#post").bind("submit",
j);e=b("#cred-wizard-button-next");g=b("#cred-wizard-button-prev");b("#cred_wizard_quit_button");n=b("#cred-progress-bar");h=b("#cred-progress-bar-inner");for(var d=0,f=a.steps.length;d<f;d++){var i=b('<span class="cred-progress-step">'+a.steps[d].title+"</span>");i.insertBefore(n).css({left:Math.floor(100*(d+1)/f)+"%","margin-left":-i.width()+"px"})}b("#post").on("click","#cred_wizard_quit_button",function(){form_id=b("#post_ID").val();c.gui.Popups.confirm({"class":"cred-dialog",message:c.settings.locale.quit_wizard_confirm_text,
buttons:[c.settings.locale.quit_wizard_this_form,c.settings.locale.quit_wizard_all_forms,c.settings.locale.cancel_text],callback:function(d){d==c.settings.locale.quit_wizard_all_forms&&b.ajax({url:c.route(q),type:"POST",data:"cred_wizard=false",dataType:"html",success:function(){}});d==c.settings.locale.quit_wizard_this_form&&b.ajax({url:c.route(k),data:"form_id="+form_id+"&field=wizard&value=-1",type:"post",success:function(){}});if(d==c.settings.locale.quit_wizard_all_forms||d==c.settings.locale.quit_wizard_this_form)b("#post").unbind("submit",
j),a.finish()}})});b("#post").on("click","#cred-wizard-button-next",function(){a.nextStep()});b("#post").on("click","#cred-wizard-button-prev",function(){a.prevStep()});for(d=1;d<=a.step;d++)if(a.steps[d-1])a.steps[d-1].completed=!0;a.completed_step=a.step;h.css("width",100*a.step/a.steps.length+"%");a.step<a.steps.length&&a.goToStep(a.step+1)},finish:function(){a.completed_step=-1;b("#post").find(".cred-not-hide").remove();if(a.hasSidebar)b("#post-body").removeClass("columns-1").addClass("columns-2"),
b("#postbox-container-1").show(),a.hasSidebar=!1;b("#postbox-container-2 #normal-sortables, #post-body-content").children().show();b("#cred-submit, #cred_add_forms_to_site_help, .cred_related").show();c.app.dispatch("cred.wizardFinished")},init:function(b,c){m=c;if(b>=0)a.step=b,a.start()}};o.cred_wizard=a})(window,jQuery,cred_cred);
